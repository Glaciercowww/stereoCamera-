# stereoCamera-
# 立体视觉项目使用说明

## 项目概述
这是一个简化的立体视觉项目，专门针对您的需求设计：
- 棋盘格规格：6x8 内角点，方格大小 0.025m
- 支持13对左右视图图像
- 完整实现所有要求的功能

## 环境准备

### 安装依赖
```bash
pip install opencv-python
pip install numpy
pip install matplotlib
```

### 图像文件准备
请将您的13对图像按以下格式命名并放在同一文件夹内：
```
left_01.jpg, right_01.jpg
left_02.jpg, right_02.jpg
left_03.jpg, right_03.jpg
...
left_13.jpg, right_13.jpg
```

## 运行步骤

### 1. 直接运行
```bash
python simple_stereo_vision.py
```

### 2. 指定图像文件夹
程序会询问图像文件夹路径，您可以：
- 直接按回车（使用当前目录）
- 输入图像文件夹的完整路径

### 3. 查看结果
程序将自动完成以下步骤并显示结果：
1. 加载图像并检测棋盘格角点
2. 执行相机标定
3. 显示标定参数
4. 图像校正对比
5. 视差图计算
6. 三维重建和关键点坐标

## 输出结果

### 1. 相机内参矩阵 (3分)
程序会显示左右相机的内参矩阵，格式如下：
```
左相机内参矩阵 (像素):
[[fx  0  cx]
 [ 0 fy  cy]
 [ 0  0   1]]
```

### 2. 基本矩阵F和本质矩阵E (3分)
```
本质矩阵 E:
[[ ... ... ...]
 [ ... ... ...]
 [ ... ... ...]]

基本矩阵 F:
[[ ... ... ...]
 [ ... ... ...]
 [ ... ... ...]]
```

### 3. 相机相对位置和姿态R,T (3分)
```
旋转矩阵 R:
[[ ... ... ...]
 [ ... ... ...]
 [ ... ... ...]]

平移向量 T (米):
[tx ty tz]

基线距离: X.XXXX 米
旋转角度: X.XX 度
```

### 4. 校正前后图像对比 (3分)
程序会显示4个子图：
- 左上：原始左图像
- 右上：原始右图像  
- 左下：校正后左图像
- 右下：校正后右图像

还会显示极线验证图，绿色水平线应该通过对应的特征点。

### 5. 视差图 (4分)
显示三个子图：
- 左：校正后左图像（灰度）
- 中：校正后右图像（灰度）
- 右：视差图（彩色编码）

同时输出视差统计信息：
```
视差统计:
  有效像素数: XXXXX
  视差范围: X.XX ~ XX.XX 像素
  平均视差: XX.XX 像素
```

### 6. 三维重建结果 (4分)
#### 关键点坐标表格
```
位置        图像坐标(x,y)   三维坐标(X,Y,Z)米           深度(米)
左上区域    (160,120)      (-0.123, -0.089,  1.234)   1.234
中心点      (320,240)      ( 0.000,  0.000,  1.456)   1.456
右上区域    (480,120)      ( 0.123, -0.089,  1.234)   1.234
左下区域    (160,360)      (-0.123,  0.089,  1.234)   1.234
右下区域    (480,360)      ( 0.123,  0.089,  1.234)   1.234
```

#### 可视化图像
- 标记了关键点位置的图像
- 三维点云散点图

#### 点云文件
程序会生成 `point_cloud.xyz` 文件，格式为：
```
X Y Z R G B
0.123 -0.045 1.234 255 128 64
...
```

## 故障排除

### 常见问题

#### 1. 图像文件找不到
- 检查文件命名格式是否正确
- 确保图像文件在指定文件夹内

#### 2. 角点检测失败
- 检查棋盘格是否清晰可见
- 确保棋盘格没有被遮挡或反光
- 图像质量要足够好

#### 3. 标定误差过大
- 增加有效图像对数量
- 确保图像覆盖整个视野范围
- 检查棋盘格是否平整

#### 4. 视差图质量差
- 这是正常现象，真实场景的视差计算比较困难
- 可以调整SGBM算法参数
- 确保两个相机之间有足够的基线距离

### 参数调整

如果需要调整算法参数，可以修改代码中的以下部分：

#### SGBM参数
```python
# 在 compute_disparity 函数中
window_size = 5        # 匹配窗口大小
num_disp = 80         # 视差搜索范围
```

#### 深度过滤
```python
# 在 compute_3d_points 函数中
z_mask = (valid_points[:, 2] > 0) & (valid_points[:, 2] < 10)  # 深度范围
```

## 结果评估

### 评分标准对照
1. ✅ **相机内参矩阵 (3分)**: 完整输出左右相机内参
2. ✅ **基本矩阵F及本质矩阵E (3分)**: 自动计算并显示
3. ✅ **相机相对位置和姿态R,T (3分)**: 双目标定自动获得
4. ✅ **校正前后图像 (3分)**: 直观对比显示
5. ✅ **视差图 (4分)**: SGBM算法计算，彩色可视化
6. ✅ **三维重建结果 (4分)**: 关键点坐标表格 + 点云文件

### 预期输出质量
- **标定精度**: 重投影误差通常 < 1.0 像素
- **视差图**: 根据场景复杂度，会有一定噪声
- **三维重建**: 提供准确的关键点坐标
- **点云质量**: 取决于视差图质量和场景纹理

## 使用建议

1. **图像质量**: 确保图像清晰，棋盘格角点清楚可见
2. **光照条件**: 避免强烈阴影和反光
3. **角度变化**: 13对图像应该覆盖不同的角度和位置
4. **距离变化**: 包含不同距离的标定图像
5. **稳定支撑**: 拍摄时保持相机稳定

运行完成后，您将获得满足所有课程要求的完整结果！
